<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="goBack()">
        <ion-icon name="arrow-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title class="center-title">{{ 'Agent placement' | translate }}</ion-title>
    <ion-buttons slot="end">
      <ion-button>
        <ion-icon name="notifications-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="cls-supervisor">
    <div class="cards-list">
      <ion-grid>
        <ion-row class="ion-align-items-center ion-justify-content-between">
          <ion-col size="2" class="avatar-col">
            <img [src]="data.agent.user.photo.url || 'assets/img/avatar.png'" alt="Avatar" class="avatar-img" />
          </ion-col>
          <ion-col size="10" class="info-col">
            <ion-row class="name-row">{{data.agent.user.first_name + ' ' + data.agent.user.last_name}}</ion-row>
            <ion-row class="missions-row">{{data.agent.planning_punctuals}} {{data.agent.planning_punctuals == 1 ? 'mission' : 'missions'}}</ion-row>
          </ion-col>
        </ion-row>
      </ion-grid>
    </div>
    <div class="section-title">Missions ponctuels disponibles</div>
    <div class="custom-search">
      <input type="text" placeholder="Rechercher Mission" class="search-input" name="search" />
      <ion-icon name="search-outline" class="input-icon"></ion-icon>
    </div>
    <div class="date-display">{{tommorrow }}</div>
  </div>

  <ion-radio-group [(ngModel)]="selectedSite" class="radio-group">
    <ion-card class="card pd-15" *ngFor="let item of data.plannings" (click)="selectedSite = item.id" [class.selected]="selectedSite === item.id">
      <ion-card-header class="card-header">
        <ion-card-title>
          <ion-grid>
            <ion-row>
              <ion-col size="3" class="logo-col">
                <img class="logo" [src]="item.logo?.url || 'assets/img/logo_pitch 5.png'" style="min-height: 54px" />
              </ion-col>
              <ion-col size="7" class="text-col">
                <p class="name-campany">{{ item.intervention_name }}</p>
              </ion-col>
              <ion-col size="2" class="radio-col">
                <ion-radio [value]="item.id" class="custom-radio"></ion-radio>
              </ion-col>
            </ion-row>
          </ion-grid>
          <ion-chip class="custom-chip" [class.chipSelected]="selectedSite === item.id">{{ item.prestation }}</ion-chip>
          <ion-row class="agent-row">
            <ion-col size="6" class="img-text-col">
              <div class="img-text-wrapper">
                <img src="assets/img/agent.png" alt="Agent" class="agent-img" />
                <span
                  class="agents-text"
                  [ngStyle]="{
                  'color': item.team.length > item.agent_needed ? 'orange' :
                            item.team.length == item.agent_needed ? 'green' : 'red'
                }"
                >
                  {{ item.team.length }} / {{ item.agent_needed }}
                </span>
              </div>
            </ion-col>
            <ion-col size="6" class="chip-col">
              <div class="chip-custom">
                <ion-icon name="navigate-outline"></ion-icon>
                <span>{{calculateDistance(item.lat , item.long , data.agent?.user?.lat , data.agent?.user?.long ).toFixed(2 )}} km</span>
              </div>
            </ion-col>
          </ion-row>
        </ion-card-title>
      </ion-card-header>
    </ion-card>
  </ion-radio-group>

  <div class="button-container">
    <button class="custom-button" (click)="placementOfAgentsConfirmModal()">Affecter</button>
  </div>
  <ion-alert
    [isOpen]="isAlertOpen"
    header="Agent deja affecté"
    subHeader="L'agent est déjà affecté a cette mission."
    message="Merci de choisir une autre mission ou bien changer l'agent.  "
    [buttons]="alertButtons"
    (didDismiss)="setOpen(false)"
  ></ion-alert>
</ion-content>
